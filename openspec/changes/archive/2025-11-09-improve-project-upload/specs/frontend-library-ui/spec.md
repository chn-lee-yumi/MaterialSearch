# frontend-library-ui Delta

## ADDED Requirements

### Requirement: 添加素材对话框
系统 SHALL 在项目库模式下提供添加素材对话框。

#### Scenario: 切换到项目库显示添加入口
- **GIVEN** 用户切换到项目 "万科广场项目"
- **WHEN** 页面刷新完成
- **THEN** 顶部显示 "添加素材" 按钮
- **AND** 按钮位于 "项目管理" 按钮旁边

#### Scenario: 切换到永久库隐藏添加入口
- **GIVEN** 用户切换回 "永久素材库"
- **WHEN** 页面刷新
- **THEN** "添加素材" 按钮隐藏
- **AND** 保留原有扫描按钮

#### Scenario: 打开添加素材对话框
- **GIVEN** 当前项目为 "万科广场项目"
- **WHEN** 用户点击 "添加素材" 按钮
- **THEN** 打开对话框
- **AND** 标题显示 "为项目添加素材：万科广场项目"
- **AND** 显示路径输入区域

### Requirement: 路径输入和粘贴
系统 SHALL 支持复制粘贴文件/文件夹路径。

#### Scenario: 粘贴单个文件夹路径
- **GIVEN** 用户复制文件夹路径 `\\Daga-nas5\...\1102`
- **WHEN** 粘贴到输入框
- **THEN** 输入框显示该路径
- **AND** 显示 "预览文件" 按钮

#### Scenario: 粘贴多个路径（混合）
- **GIVEN** 用户复制多行路径：
  ```
  "\\Daga-nas5\...\1102\image.jpg"
  "\\Daga-nas5\...\1102\渲染图"
  ```
- **WHEN** 粘贴到输入框
- **THEN** 自动去除引号
- **AND** 识别为2个路径

#### Scenario: 历史路径快速选择
- **GIVEN** 用户之前使用过路径 `\\Daga-nas5\...\1101`
- **WHEN** 点击 "历史路径" 下拉菜单
- **THEN** 显示最近使用的10个路径
- **AND** 按项目分组显示
- **AND** 点击路径自动填充到输入框

### Requirement: 文件预览列表
系统 SHALL 显示待索引文件的预览列表。

#### Scenario: 点击预览文件
- **GIVEN** 用户输入路径 `\\Daga-nas5\...\1102`
- **WHEN** 点击 "预览文件" 按钮
- **THEN** 调用 `POST /api/preview_files`
- **AND** 显示加载动画 "正在扫描文件..."
- **AND** 扫描完成后显示文件列表

#### Scenario: 显示文件列表
- **GIVEN** 预览返回 28 个文件
- **WHEN** 列表显示
- **THEN** 每行显示：
  - 勾选框（默认勾选，已索引文件除外）
  - 文件类型图标（图片/视频/PDF）
  - 缩略图占位符
  - 文件名
  - 文件大小
- **AND** 底部显示 "已选择 25 个文件，总大小 320 MB"

#### Scenario: 缩略图懒加载
- **GIVEN** 文件列表有 50 个文件
- **WHEN** 对话框打开
- **THEN** 首屏（前20个）立即请求缩略图
- **AND** 显示加载中占位符
- **WHEN** 用户滚动列表
- **THEN** 可见区域的文件请求缩略图
- **AND** 缩略图加载后替换占位符

#### Scenario: 已索引文件标识
- **GIVEN** 文件 `image.jpg` 已在项目库中
- **WHEN** 显示在列表中
- **THEN** 勾选框默认取消
- **AND** 显示标签 "已索引"
- **AND** 文件名为灰色
- **AND** 用户可手动勾选（重新索引）

### Requirement: 文件筛选和操作
系统 SHALL 提供文件筛选功能。

#### Scenario: 全选/反选
- **GIVEN** 文件列表有 28 个文件
- **WHEN** 用户点击 "全选"
- **THEN** 所有文件（包括已索引）被勾选
- **WHEN** 用户点击 "反选"
- **THEN** 已勾选变未勾选，未勾选变勾选

#### Scenario: 按类型筛选
- **GIVEN** 文件列表包含图片、视频、PDF
- **WHEN** 用户点击 "仅图片"
- **THEN** 仅显示图片文件
- **AND** 其他类型文件隐藏
- **AND** 勾选状态保持

#### Scenario: 手动取消单个文件
- **GIVEN** 文件 `~$temp.docx` 在列表中
- **WHEN** 用户取消勾选
- **THEN** 该文件不被索引
- **AND** 底部统计更新："已选择 24 个文件"

#### Scenario: 批量删除未勾选项
- **GIVEN** 10 个文件未勾选
- **WHEN** 用户点击 "清理未勾选"
- **THEN** 从列表移除这10个文件
- **AND** 列表仅显示勾选的文件

### Requirement: 索引进度显示
系统 SHALL 显示实时索引进度。

#### Scenario: 开始索引
- **GIVEN** 用户勾选 25 个文件
- **WHEN** 点击 "开始索引" 按钮
- **THEN** 按钮变为 "索引中..." 不可点击
- **AND** 显示进度条（0%）
- **AND** 显示 "正在索引: 准备中..."

#### Scenario: 实时进度更新
- **GIVEN** 索引任务正在执行
- **WHEN** 每 500ms 轮询一次进度
- **THEN** 进度条更新
- **AND** 显示当前文件："正在索引: image_10.jpg (10/25)"
- **AND** 显示预计剩余时间："预计剩余: 23秒"

#### Scenario: 索引完成显示报告
- **GIVEN** 索引完成
- **WHEN** 所有文件处理完毕
- **THEN** 显示完成对话框：
  ```
  索引完成
  成功: 23个文件
  失败: 1个文件
  重复跳过: 1个文件

  [查看详情] [关闭]
  ```

#### Scenario: 查看详细报告
- **GIVEN** 索引完成对话框
- **WHEN** 用户点击 "查看详情"
- **THEN** 展开显示：
  - 失败文件列表（文件名 + 错误原因）
  - 重复文件列表（文件名 + 处理方式）
  - 总耗时

#### Scenario: 中途取消索引
- **GIVEN** 索引进行到 10/25
- **WHEN** 用户点击 "取消" 按钮
- **THEN** 显示确认对话框："已处理10个文件将保留，确认取消？"
- **WHEN** 用户确认
- **THEN** 停止索引
- **AND** 显示部分完成报告："已索引 10/25 个文件"

### Requirement: 重复文件处理对话框
系统 SHALL 在检测到重复文件时提供对比界面。

#### Scenario: 检测到重复文件
- **GIVEN** 索引到文件 `render_final.png`
- **AND** 数据库中存在相同 phash
- **WHEN** 索引暂停
- **THEN** 显示重复文件对话框
- **AND** 标题："发现重复文件"

#### Scenario: 显示对比预览
- **GIVEN** 重复文件对话框
- **WHEN** 对话框打开
- **THEN** 左右两栏显示：
  - 左侧：已有文件（缩略图、路径、大小、修改时间）
  - 右侧：新文件（缩略图、路径、大小、修改时间）
- **AND** 突出显示差异（如较新的文件标记"更新"）

#### Scenario: 用户选择跳过
- **GIVEN** 重复文件对话框
- **WHEN** 用户点击 "跳过"
- **THEN** 关闭对话框
- **AND** 不索引该文件
- **AND** 继续下一个文件

#### Scenario: 用户选择覆盖
- **GIVEN** 重复文件对话框
- **WHEN** 用户点击 "覆盖"
- **THEN** 删除旧记录
- **AND** 索引新文件
- **AND** 继续下一个文件

#### Scenario: 记住选择应用到后续
- **GIVEN** 重复文件对话框
- **WHEN** 用户勾选 "记住选择，应用到所有重复文件"
- **AND** 点击 "跳过"
- **THEN** 后续重复文件自动跳过
- **AND** 不再弹出对话框

#### Scenario: 批量操作按钮
- **GIVEN** 重复文件对话框
- **WHEN** 显示按钮
- **THEN** 提供四个按钮：
  - "跳过" - 跳过当前文件
  - "覆盖" - 覆盖当前文件
  - "全部跳过" - 跳过所有重复
  - "全部覆盖" - 覆盖所有重复

### Requirement: 历史路径管理
系统 SHALL 记录和管理历史使用的路径。

#### Scenario: 保存路径到历史
- **GIVEN** 用户成功索引路径 `\\Daga-nas5\...\1102`
- **WHEN** 索引完成
- **THEN** 保存到 `localStorage`
- **AND** 与项目ID关联
- **AND** 记录使用时间

#### Scenario: 显示项目路径历史
- **GIVEN** 当前项目 "万科广场项目"
- **WHEN** 打开历史路径下拉
- **THEN** 仅显示该项目的历史路径
- **AND** 按时间倒序排列
- **AND** 最多显示10条

#### Scenario: 清理历史路径
- **GIVEN** 历史路径下拉菜单
- **WHEN** 用户点击 "清空历史"
- **THEN** 确认对话框："确认清空所有历史路径？"
- **WHEN** 确认
- **THEN** 清空 `localStorage` 中该项目的路径记录

### Requirement: 响应式适配
系统 SHALL 确保添加素材对话框在不同设备上可用。

#### Scenario: 桌面端大屏显示
- **GIVEN** 屏幕宽度 >= 1024px
- **WHEN** 打开对话框
- **THEN** 对话框宽度 800px
- **AND** 文件列表高度 500px（可滚动）
- **AND** 左右分栏（路径输入 | 预览列表）

#### Scenario: 笔记本小屏适配
- **GIVEN** 屏幕宽度 1366px
- **WHEN** 打开对话框
- **THEN** 对话框宽度 80%
- **AND** 文件列表高度 60vh

#### Scenario: 移动端禁用
- **GIVEN** 屏幕宽度 < 768px
- **WHEN** 检测到移动设备
- **THEN** "添加素材" 按钮禁用
- **AND** 悬停提示："移动端不支持路径上传，请使用桌面浏览器"
